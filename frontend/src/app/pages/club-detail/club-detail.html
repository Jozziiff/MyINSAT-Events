@if (loading()) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading club details...</p>
  </div>
} @else if (error()) {
  <div class="error-container container">
    <h2>Oops!</h2>
    <p>{{ error() }}</p>
    <a routerLink="/clubs" class="btn-back">Back to Clubs</a>
  </div>
} @else if (club(); as clubData) {
  <div class="club-detail-page">
    <!-- Pending Status Banner -->
    @if (isPending()) {
      <div class="pending-banner" @fadeSlideIn>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>This club is pending admin approval and is only visible to you.</span>
      </div>
    }

    <!-- Hero Section -->
    <app-club-hero
      [name]="clubData.name"
      [tagline]="clubData.shortDescription"
      [logoUrl]="clubData.logoUrl"
      [coverUrl]="clubData.coverImageUrl || ''"
      [foundedYear]="clubData.foundedYear || null"
      [showBackButton]="true"
      [showEditButton]="canEdit()"
      [editLink]="['/clubs', clubData.id, 'edit']"
      [showFollowButton]="true"
      [showFollowerCount]="true"
      [isLoggedIn]="isLoggedIn()"
      [isFollowing]="isFollowing()"
      [followLoading]="followLoading()"
      [followerCount]="followerCount()"
      (followClick)="toggleFollow()"
      (followerCountClick)="openFollowersPopup()">
    </app-club-hero>

    <!-- View Events CTA Button -->
    <div class="cta-button-top" @fadeInRight>
      <button class="btn-primary" (click)="viewClubEvents()">
        View Past Events
      </button>
    </div>

    <!-- About Section -->
    <div class="container" @fadeSlideIn>
      <app-club-section-row
        title="About Us"
        [content]="clubData.about"
        [imageUrl]="clubData.aboutImageUrl || ''">
      </app-club-section-row>
    </div>

    <!-- Dynamic Sections (alternating layout) -->
    @for (item of sections(); track item.key) {
      <div class="container" @fadeSlideIn>
        <app-club-section-row
          [title]="item.section.title"
          [content]="item.section.content"
          [imageUrl]="item.section.imageUrl || ''"
          [reversed]="!item.imageLeft">
        </app-club-section-row>
      </div>
    }

    <!-- Contact Section -->
    <div class="container" @fadeSlideIn>
      <app-club-contact-section
        [contact]="clubData.contact || null">
      </app-club-contact-section>
    </div>
  </div>

  <!-- Followers Popup -->
  @if (showFollowersPopup()) {
    <div class="popup-overlay" (click)="onPopupBackdropClick($event)">
      <div class="popup-modal followers-popup" @fadeSlideIn>
        <div class="popup-header">
          <h3>Followers</h3>
          <button class="popup-close" (click)="closeFollowersPopup()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="popup-content">
          @if (loadingFollowers()) {
            <div class="popup-loading">
              <div class="loading-spinner"></div>
              <p>Loading followers...</p>
            </div>
          } @else if (followers().length === 0) {
            <div class="popup-empty">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
              <p>No followers yet</p>
            </div>
          } @else {
            <ul class="followers-list">
              @for (follower of followers(); track follower.id) {
                <li class="follower-item">
                  <a [routerLink]="['/users', follower.id]" class="follower-link" (click)="closeFollowersPopup()">
                    <div class="follower-avatar">
                      @if (follower.avatarUrl) {
                        <img [src]="follower.avatarUrl" [alt]="follower.fullName">
                      } @else {
                        <div class="avatar-placeholder">
                          {{ follower.fullName.charAt(0).toUpperCase() }}
                        </div>
                      }
                    </div>
                    <span class="follower-name">{{ follower.fullName }}</span>
                  </a>
                </li>
              }
            </ul>
          }
        </div>
      </div>
    </div>
  }
}
