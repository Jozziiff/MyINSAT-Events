<div class="page-container container" @fadeSlideIn>
    <header class="page-header">
        <div class="text-content">
            <h1>Manager Dashboard</h1>
            <p>Manage events for <strong>{{ clubName() }}</strong></p>
        </div>

        <div class="header-actions">
            <button class="btn-primary" routerLink="/manager/events/new">

                Create Event
            </button>
            <button class="btn-outline" routerLink="/manager/club">
                Club Settings
            </button>
        </div>
    </header>

    @if (loading()) {
    <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading events...</p>
    </div>
    }

    @if (error()) {
    <div class="error-state">
        <p>{{ error() }}</p>
        <button class="btn-outline" (click)="loadData()">Retry</button>
    </div>
    }

    @if (!loading() && !error()) {
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-value">{{ events().length }}</div>
            <div class="stat-label">Total Events</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ publishedCount() }}</div>
            <div class="stat-label">Published</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ draftCount() }}</div>
            <div class="stat-label">Drafts</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ joinRequests().length }}</div>
            <div class="stat-label">Pending Requests</div>
        </div>
    </div>

    @if (joinRequests().length > 0) {
    <div class="section-header">
        <h2>Join Requests ({{ joinRequests().length }})</h2>
    </div>
    <div class="join-requests-list">
        @for (request of joinRequests(); track request.id) {
        <div class="join-request-card">
            <div class="request-user">
                @if (request.user.avatarUrl) {
                <img [src]="request.user.avatarUrl" alt="Avatar" class="user-avatar" />
                } @else {
                <div class="user-avatar-placeholder">{{ request.user.fullName.charAt(0) }}</div>
                }
                <div class="user-info">
                    <span class="user-name">{{ request.user.fullName }}</span>
                    <span class="user-email">{{ request.user.email }}</span>
                </div>
            </div>
            <div class="request-date">
                {{ formatDate(request.createdAt.toString()) }}
            </div>
            <div class="request-actions">
                <button class="btn-approve" (click)="approveRequest(request)">Approve</button>
                <button class="btn-reject" (click)="rejectRequest(request)">Reject</button>
            </div>
        </div>
        }
    </div>
    }

    @if (events().length === 0) {
    <div class="empty-state">
        <h3>No events yet</h3>
        <p>Create your first event to get started</p>
        <button class="btn-primary" routerLink="/manager/events/new">Create Event</button>
    </div>
    } @else {

    @if (upcomingEvents().length > 0) {
    <div class="section-header">
        <h2>Upcoming Events ({{ upcomingEvents().length }})</h2>
    </div>
    <div class="events-table">
        <table>
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Date & Time</th>
                    <th>Location</th>
                    <th>Capacity</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @for (event of upcomingEvents(); track event.id) {
                <tr>
                    <td>
                        <div class="event-title-cell">
                            <strong>{{ event.title }}</strong>
                            @if (event.description) {
                            <span class="event-desc">{{ event.description }}</span>
                            }
                        </div>
                    </td>
                    <td>
                        <div class="date-cell">
                            <span class="date">{{ formatDate(event.startTime) }}</span>
                            <span class="time">{{ formatTime(event.startTime) }}</span>
                        </div>
                    </td>
                    <td>{{ event.location }}</td>
                    <td>{{ event.capacity }}</td>
                    <td>{{ event.price ? event.price + ' TND' : 'Free' }}</td>
                    <td>
                        <span class="status-pill" [class]="getStatusClass(event.status)">
                            {{ event.status }}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon" title="View" (click)="viewEvent(event.id)">View</button>
                            @if (event.status === 'DRAFT') {
                            <button class="btn-icon" title="Publish" (click)="publishEvent(event)">Publish</button>
                            }
                            @if (event.status === 'PUBLISHED') {
                            <button class="btn-icon" title="View Registrations"
                                (click)="viewRegistrations(event.id)">Registrations</button>
                            }
                            <button class="btn-icon" title="Edit" (click)="editEvent(event.id)">Edit</button>
                            <button class="btn-icon btn-danger" title="Delete"
                                (click)="deleteEvent(event)">Delete</button>
                        </div>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    }

    @if (pastEvents().length > 0) {
    <div class="section-header">
        <h2>Past Events ({{ pastEvents().length }})</h2>
    </div>
    <div class="events-table past-events">
        <table>
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Date & Time</th>
                    <th>Location</th>
                    <th>Capacity</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @for (event of pastEvents(); track event.id) {
                <tr class="past-event-row">
                    <td>
                        <div class="event-title-cell">
                            <strong>{{ event.title }}</strong>
                            @if (event.description) {
                            <span class="event-desc">{{ event.description }}</span>
                            }
                        </div>
                    </td>
                    <td>
                        <div class="date-cell">
                            <span class="date">{{ formatDate(event.startTime) }}</span>
                            <span class="time">{{ formatTime(event.startTime) }}</span>
                        </div>
                    </td>
                    <td>{{ event.location }}</td>
                    <td>{{ event.capacity }}</td>
                    <td>{{ event.price ? event.price + ' TND' : 'Free' }}</td>
                    <td>
                        <span class="status-pill" [class]="getStatusClass(event.status)">
                            {{ event.status }}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon" title="View" (click)="viewEvent(event.id)">View</button>
                            @if (event.status === 'PUBLISHED') {
                            <button class="btn-icon" title="View Registrations"
                                (click)="viewRegistrations(event.id)">Registrations</button>
                            }
                            <button class="btn-icon btn-danger" title="Delete"
                                (click)="deleteEvent(event)">Delete</button>
                        </div>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    }
    }
    }
</div>