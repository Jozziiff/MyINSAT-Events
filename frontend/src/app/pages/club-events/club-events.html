<section class="club-events-page" @fadeSlideIn>
  <!-- Header -->
  <div class="page-header">
    <button class="back-btn" (click)="goBack()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back
    </button>
    <div class="header-content">
      <h1>{{ clubName() || 'Club Events' }}</h1>
      <p class="subtitle">Past Events & Statistics</p>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading events...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-container glass-card">
      <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <p>{{ error() }}</p>
      <button class="retry-btn" (click)="loadEvents(clubId())">Try Again</button>
    </div>
  }

  <!-- Content -->
  @if (!loading() && !error() && eventsData()) {
    <!-- Stats Summary Cards -->
    <div class="stats-grid">
      <div class="stat-card glass-card">
        <div class="stat-icon stat-icon--primary">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value">{{ statistics().totalEvents }}</span>
          <span class="stat-label">Total Events</span>
        </div>
      </div>

      <div class="stat-card glass-card">
        <div class="stat-icon stat-icon--success">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value">{{ statistics().totalAttendance }}</span>
          <span class="stat-label">Total Attendees</span>
        </div>
      </div>

      <div class="stat-card glass-card">
        <div class="stat-icon stat-icon--accent">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value">{{ statistics().averageAttendanceRate }}%</span>
          <span class="stat-label">Avg Attendance</span>
        </div>
      </div>

      <div class="stat-card glass-card">
        <div class="stat-icon stat-icon--warning">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-value">{{ statistics().averageRating > 0 ? statistics().averageRating.toFixed(1) : '-' }}</span>
          <span class="stat-label">Avg Rating</span>
        </div>
      </div>
    </div>

    <!-- Events List -->
    @if (pastEvents().length === 0) {
      <div class="empty-state glass-card">
        <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <h3>No Past Events</h3>
        <p>This club hasn't organized any events yet.</p>
      </div>
    } @else {
      <div class="events-section">
        <h2 class="section-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          Past Events
        </h2>

        <div class="events-list">
          @for (event of pastEvents(); track event.id) {
            <a [routerLink]="['/events', event.id]" class="event-card glass-card">
              <!-- Event Image -->
              <div class="event-image-wrapper">
                @if (event.photoUrl) {
                  <img [src]="event.photoUrl" [alt]="event.title" class="event-image">
                } @else {
                  <div class="event-image-placeholder">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="16" y1="2" x2="16" y2="6"></line>
                      <line x1="8" y1="2" x2="8" y2="6"></line>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                  </div>
                }
                <span class="event-badge ended">Ended</span>
              </div>

              <!-- Event Content -->
              <div class="event-content">
                <div class="event-header">
                  <h3 class="event-title">{{ event.title }}</h3>
                  <div class="event-date">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="16" y1="2" x2="16" y2="6"></line>
                      <line x1="8" y1="2" x2="8" y2="6"></line>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    {{ formatDate(event.startTime) }}
                  </div>
                </div>

                @if (event.description) {
                  <p class="event-description">{{ event.description }}</p>
                }

                <!-- Event Meta -->
                <div class="event-meta">
                  @if (event.location) {
                    <span class="meta-item">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                      </svg>
                      {{ event.location }}
                    </span>
                  }
                  @if (event.price && event.price > 0) {
                    <span class="meta-item">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                      </svg>
                      {{ event.price }} TND
                    </span>
                  }
                </div>

                <!-- Event Stats -->
                <div class="event-stats">
                  <div class="event-stat">
                    <span class="event-stat-value">{{ event.registrationsCount }}</span>
                    <span class="event-stat-label">Registrations</span>
                  </div>
                  <div class="event-stat">
                    <span class="event-stat-value">{{ event.attendedCount }}</span>
                    <span class="event-stat-label">Attended</span>
                  </div>
                  <div class="event-stat">
                    <span class="event-stat-value">{{ event.attendanceRate }}%</span>
                    <span class="event-stat-label">Rate</span>
                  </div>
                  <div class="event-stat">
                    <div class="rating-value">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                      </svg>
                      <span class="event-stat-value">{{ event.averageRating > 0 ? event.averageRating.toFixed(1) : '-' }}</span>
                    </div>
                    <span class="event-stat-label">Rating</span>
                  </div>
                </div>
              </div>
            </a>
          }
        </div>
      </div>
    }
  }
</section>

