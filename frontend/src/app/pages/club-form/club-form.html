<div class="create-club-layout" @fadeSlideIn>
  <!-- Left Side: Form -->
  <aside class="form-panel">
    <header class="panel-header">
      <a routerLink="/clubs" class="btn-back">Back to Clubs</a>
      <h1>{{ isEditMode ? 'Edit Club' : 'Create New Club' }}</h1>
      <p>{{ isEditMode ? 'Update your club details' : 'Fill out the form to see the live preview' }}</p>
    </header>

    @if (loadingClub()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading club data...</p>
      </div>
    } @else if (success()) {
      <div class="success-message">
        <span class="success-icon">âœ“</span>
        @if (isEditMode) {
          <p>Club updated successfully! Redirecting...</p>
        } @else {
          <p>Club created successfully! It is now pending admin approval. Redirecting...</p>
        }
      </div>
    } @else {
      <form class="club-form" (ngSubmit)="onSubmit()">
        @if (error()) {
          <div class="error-message">
            <p>{{ error() }}</p>
          </div>
        }

        <!-- Required Fields Section -->
        <section class="form-section">
          <h2>Basic Information <span class="required-badge">Required</span></h2>

          <div class="form-group">
            <label for="name">Club Name *</label>
            <input
              type="text"
              id="name"
              [(ngModel)]="name"
              name="name"
              placeholder="e.g., IEEE INSAT"
              required
            >
          </div>

          <div class="form-group">
            <label for="shortDescription">Tagline *</label>
            <input
              type="text"
              id="shortDescription"
              [(ngModel)]="shortDescription"
              name="shortDescription"
              placeholder="A brief tagline for your club"
              maxlength="150"
              required
            >
            <span class="char-count">{{ shortDescription.length }}/150</span>
          </div>

          <div class="form-group">
            <label for="about">About *</label>
            <textarea
              id="about"
              [(ngModel)]="about"
              name="about"
              placeholder="Tell people about your club..."
              rows="4"
              required
            ></textarea>
          </div>

          <div class="form-group founded-year-group">
            <label for="foundedYear">Founded Year</label>
            <div class="year-input-wrapper">
              <svg class="year-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <select
                id="foundedYear"
                [(ngModel)]="foundedYear"
                name="foundedYear"
                class="year-select"
              >
                <option [ngValue]="null">Select year...</option>
                @for (year of yearOptions; track year) {
                  <option [ngValue]="year">{{ year }}</option>
                }
              </select>
            </div>
            <span class="field-hint">The year your club was originally founded</span>
          </div>
        </section>

        <!-- Images Section -->
        <section class="form-section">
          <h2>Club Images</h2>

          <app-image-upload-field
            label="Club Logo"
            inputId="logo"
            placeholder="https://example.com/logo.png"
            [preview]="logoPreview"
            [(ngModel)]="logoUrl"
            [ngModelOptions]="{standalone: true}"
            (fileSelected)="onImageFileSelected($event, 'logo')"
            [required]="true">
          </app-image-upload-field>

          <app-image-upload-field
            label="Cover Image"
            inputId="cover"
            placeholder="https://example.com/cover.jpg"
            [preview]="coverPreview"
            [(ngModel)]="coverUrl"
            [ngModelOptions]="{standalone: true}"
            (fileSelected)="onImageFileSelected($event, 'cover')"
            size="wide"
            [required]="true">
          </app-image-upload-field>

          <app-image-upload-field
            label="About Section Image"
            inputId="aboutImage"
            placeholder="https://example.com/about.jpg"
            [preview]="aboutImagePreview"
            [(ngModel)]="aboutImageUrl"
            [ngModelOptions]="{standalone: true}"
            (fileSelected)="onImageFileSelected($event, 'about')">
          </app-image-upload-field>
        </section>

        <!-- Optional Sections -->
        <section class="form-section">
          <h2>Optional Sections</h2>
          <p class="section-hint">Toggle sections to add more content to your club page.</p>

          @for (key of getSectionKeys(); track key) {
            <div class="optional-section" [class.enabled]="sections[key].enabled">
              <div class="section-toggle">
                <label class="toggle-switch">
                  <input type="checkbox" [(ngModel)]="sections[key].enabled" [name]="key + 'Enabled'">
                  <span class="slider"></span>
                </label>
                <span class="toggle-label">{{ getSectionLabel(key) }}</span>
              </div>

              @if (sections[key].enabled) {
                <div class="section-fields" @fadeSlideIn>
                  <div class="form-group">
                    <label>Title</label>
                    <input
                      type="text"
                      [(ngModel)]="sections[key].title"
                      [name]="key + 'Title'"
                      [placeholder]="'e.g., ' + getSectionLabel(key)"
                    >
                  </div>

                  <div class="form-group">
                    <label>Content</label>
                    <textarea
                      [(ngModel)]="sections[key].content"
                      [name]="key + 'Content'"
                      placeholder="Write about this section..."
                      rows="3"
                    ></textarea>
                  </div>

                  <app-image-upload-field
                    label="Image (optional)"
                    [inputId]="key"
                    placeholder="Image URL"
                    [preview]="sections[key].imagePreview"
                    [(ngModel)]="sections[key].imageUrl"
                    [ngModelOptions]="{standalone: true}"
                    (fileSelected)="onImageFileSelected($event, key)"
                    size="small">
                  </app-image-upload-field>
                </div>
              }
            </div>
          }
        </section>

        <!-- Contact Information -->
        <section class="form-section">
          <h2>Contact Information <span class="optional-badge">Optional</span></h2>

          <div class="form-row">
            <div class="form-group">
              <label for="email">Email</label>
              <input
                type="email"
                id="email"
                [(ngModel)]="contact.email"
                name="email"
                placeholder="club@example.com"
              >
            </div>

            <div class="form-group">
              <label for="phone">Phone</label>
              <input
                type="tel"
                id="phone"
                [(ngModel)]="contact.phone"
                name="phone"
                placeholder="+216 XX XXX XXX"
              >
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="website">Website</label>
              <input
                type="url"
                id="website"
                [(ngModel)]="contact.website"
                name="website"
                placeholder="https://yourclub.com"
              >
            </div>

            <div class="form-group">
              <label for="facebook">Facebook</label>
              <input
                type="url"
                id="facebook"
                [(ngModel)]="contact.facebook"
                name="facebook"
                placeholder="https://facebook.com/yourclub"
              >
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="instagram">Instagram</label>
              <input
                type="url"
                id="instagram"
                [(ngModel)]="contact.instagram"
                name="instagram"
                placeholder="https://instagram.com/yourclub"
              >
            </div>

            <div class="form-group">
              <label for="linkedin">LinkedIn</label>
              <input
                type="url"
                id="linkedin"
                [(ngModel)]="contact.linkedin"
                name="linkedin"
                placeholder="https://linkedin.com/company/yourclub"
              >
            </div>
          </div>
        </section>

        <!-- Submit -->
        <div class="form-actions">
          <a routerLink="/clubs" class="btn-cancel">Cancel</a>
          <button type="submit" class="btn-submit" [disabled]="submitting()">
            @if (submitting()) {
              <span class="spinner"></span> {{ isEditMode ? 'Saving...' : 'Creating...' }}
            } @else {
              {{ isEditMode ? 'Save Changes' : 'Create Club' }}
            }
          </button>
        </div>
      </form>
    }
  </aside>

  <!-- Right Side: Live Preview -->
  <main class="preview-panel">
    <div class="preview-label">
      <span class="preview-dot"></span>
      Live Preview
    </div>

    <app-club-preview
      [name]="name"
      [tagline]="shortDescription"
      [about]="about"
      [logoUrl]="logoUrl"
      [logoPreview]="logoPreview"
      [coverUrl]="coverUrl"
      [coverPreview]="coverPreview"
      [aboutImageUrl]="aboutImageUrl"
      [aboutImagePreview]="aboutImagePreview"
      [sections]="getEnabledSections()"
      [contact]="contact">
    </app-club-preview>
  </main>
</div>
