<div class="create-club-layout" @fadeSlideIn>
  <!-- Left Side: Form -->
  <aside class="form-panel">
    <header class="panel-header">
      <a routerLink="/clubs" class="btn-back">Back to Clubs</a>
      <h1>{{ isEditMode ? 'Edit Club' : 'Create New Club' }}</h1>
      <p>{{ isEditMode ? 'Update your club details' : 'Fill out the form to see the live preview' }}</p>
    </header>

    @if (loadingClub()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading club data...</p>
      </div>
    } @else if (success()) {
      <div class="success-message">
        <span class="success-icon">âœ“</span>
        <p>{{ isEditMode ? 'Club updated successfully!' : 'Club created successfully! It is now pending admin approval.' }} Redirecting...</p>
      </div>
    } @else {
      <form class="club-form" (ngSubmit)="onSubmit()">
        @if (error()) {
          <div class="error-message">
            <p>{{ error() }}</p>
          </div>
        }

        <!-- Basic Information -->
        <section class="form-section">
          <h2>Basic Information <span class="required-badge">Required</span></h2>

          <app-form-input
            label="Club Name"
            inputId="name"
            [(ngModel)]="name"
            name="name"
            placeholder="e.g., IEEE INSAT"
            [required]="true">
          </app-form-input>

          <app-form-input
            label="Tagline"
            inputId="shortDescription"
            [(ngModel)]="shortDescription"
            name="shortDescription"
            placeholder="A brief tagline for your club"
            [maxLength]="150"
            [required]="true">
          </app-form-input>

          <app-form-input
            label="About"
            inputId="about"
            type="textarea"
            [(ngModel)]="about"
            name="about"
            placeholder="Tell people about your club..."
            [rows]="4"
            [required]="true">
          </app-form-input>

          <div class="form-group founded-year-group">
            <label for="foundedYear">Founded Year</label>
            <div class="year-input-wrapper">
              <svg class="year-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <select id="foundedYear" [(ngModel)]="foundedYear" name="foundedYear" class="year-select">
                <option [ngValue]="null">Select year...</option>
                @for (year of yearOptions; track year) {
                  <option [ngValue]="year">{{ year }}</option>
                }
              </select>
            </div>
            <span class="field-hint">The year your club was originally founded</span>
          </div>
        </section>

        <!-- Club Images -->
        <section class="form-section">
          <h2>Club Images</h2>

          <app-image-upload-field
            label="Club Logo"
            inputId="logo"
            placeholder="https://example.com/logo.png"
            [preview]="images.logo.preview"
            [(ngModel)]="images.logo.url"
            [ngModelOptions]="{standalone: true}"
            (fileSelected)="onImageFileSelected($event, 'logo')"
            [required]="true">
          </app-image-upload-field>

          <app-image-upload-field
            label="Cover Image"
            inputId="cover"
            placeholder="https://example.com/cover.jpg"
            [preview]="images.cover.preview"
            [(ngModel)]="images.cover.url"
            [ngModelOptions]="{standalone: true}"
            (fileSelected)="onImageFileSelected($event, 'cover')"
            size="wide"
            [required]="true">
          </app-image-upload-field>

          <app-image-upload-field
            label="About Section Image"
            inputId="aboutImage"
            placeholder="https://example.com/about.jpg"
            [preview]="images.about.preview"
            [(ngModel)]="images.about.url"
            [ngModelOptions]="{standalone: true}"
            (fileSelected)="onImageFileSelected($event, 'about')">
          </app-image-upload-field>
        </section>

        <!-- Optional Sections -->
        <section class="form-section">
          <h2>Optional Sections</h2>
          <p class="section-hint">Toggle sections to add more content to your club page.</p>

          @for (config of sectionConfigs; track config.key) {
            <app-optional-section-editor
              [config]="config"
              [section]="sections[config.key]"
              (sectionChange)="sections[config.key] = $event"
              (fileSelected)="onSectionImageSelected($event, config.key)">
            </app-optional-section-editor>
          }
        </section>

        <!-- Contact Information -->
        <section class="form-section">
          <h2>Contact Information <span class="optional-badge">Optional</span></h2>
          <app-contact-form-section
            [contact]="contact"
            (contactChange)="contact = $event">
          </app-contact-form-section>
        </section>

        <!-- Submit Actions -->
        <div class="form-actions">
          <a routerLink="/clubs" class="btn-cancel">Cancel</a>
          <button type="submit" class="btn-submit" [disabled]="submitting()">
            @if (submitting()) {
              <span class="spinner"></span> {{ isEditMode ? 'Saving...' : 'Creating...' }}
            } @else {
              {{ isEditMode ? 'Save Changes' : 'Create Club' }}
            }
          </button>
        </div>
      </form>
    }
  </aside>

  <!-- Right Side: Live Preview -->
  <main class="preview-panel">
    <div class="preview-label">
      <span class="preview-dot"></span>
      Live Preview
    </div>

    <app-club-preview
      [name]="name"
      [tagline]="shortDescription"
      [about]="about"
      [logoUrl]="images.logo.url"
      [logoPreview]="images.logo.preview"
      [coverUrl]="images.cover.url"
      [coverPreview]="images.cover.preview"
      [aboutImageUrl]="images.about.url"
      [aboutImagePreview]="images.about.preview"
      [sections]="getEnabledSections()"
      [contact]="contact">
    </app-club-preview>
  </main>
</div>
